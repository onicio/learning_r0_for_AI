<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Learning R‚ÇÄ for AI</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vanta@latest/dist/vanta.net.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background: #0f0f23; color: #333; position: relative; min-height: 100vh; }
        #vanta-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; }
        .app-container { position: relative; z-index: 1; }
        
        /* Landing Page */
        .landing-page { min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 40px 20px; }
        .landing-content { max-width: 900px; text-align: center; background: rgba(255,255,255,0.95); border-radius: 24px; padding: 60px 40px; box-shadow: 0 25px 70px rgba(0,0,0,0.4); }
        .landing-title { font-size: 3.5em; font-weight: 800; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 20px; }
        .landing-subtitle { font-size: 1.4em; color: #4a5568; margin-bottom: 40px; }
        .landing-btn { padding: 18px 40px; font-size: 1.1em; font-weight: 600; border-radius: 12px; border: none; cursor: pointer; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; box-shadow: 0 10px 25px rgba(102,126,234,0.3); transition: all 0.3s; }
        .landing-btn:hover { transform: translateY(-3px); box-shadow: 0 15px 35px rgba(102,126,234,0.4); }
        
        /* Main App */
        .main-app { display: none; padding: 20px; }
        .container { max-width: 1400px; margin: 0 auto; background: rgba(255,255,255,0.9); border-radius: 16px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); overflow: hidden; }
        .header { background: linear-gradient(135deg, #2d3748 0%, #1a202c 100%); color: white; padding: 30px; position: relative; }
        .header h1 { font-size: 2em; font-weight: 800; margin-bottom: 10px; }
        .header p { font-size: 1.1em; opacity: 0.9; }
        .back-btn { position: absolute; top: 30px; right: 30px; background: rgba(255,255,255,0.2); color: white; border: none; padding: 12px 24px; border-radius: 8px; font-weight: 600; cursor: pointer; }
        .back-btn:hover { background: rgba(255,255,255,0.3); }
        
        .tabs { display: flex; background: #f7fafc; border-bottom: 2px solid #e2e8f0; overflow-x: auto; }
        .tab { flex: 1; min-width: 120px; padding: 20px; text-align: center; cursor: pointer; font-weight: 600; transition: all 0.3s; border-bottom: 3px solid transparent; }
        .tab:hover { background: #edf2f7; }
        .tab.active { background: white; border-bottom: 3px solid #667eea; color: #667eea; }
        
        .content { padding: 30px; }
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .control-panel { background: #f7fafc; padding: 25px; border-radius: 12px; margin-bottom: 30px; }
        .control-group { margin-bottom: 20px; }
        .control-group label { display: block; font-weight: 600; margin-bottom: 8px; color: #2d3748; }
        .control-group input[type="range"] { width: 100%; height: 8px; border-radius: 5px; background: #cbd5e0; outline: none; -webkit-appearance: none; }
        .control-group input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; width: 20px; height: 20px; border-radius: 50%; background: #667eea; cursor: pointer; }
        .value-display { display: inline-block; background: #667eea; color: white; padding: 4px 12px; border-radius: 20px; font-size: 0.9em; margin-left: 10px; }
        
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .card { background: white; border: 2px solid #e2e8f0; border-radius: 12px; padding: 20px; transition: transform 0.3s; }
        .card:hover { transform: translateY(-5px); box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .card h3 { color: #2d3748; margin-bottom: 15px; font-size: 1.3em; font-weight: 700; }
        
        .metric { display: flex; justify-content: space-between; align-items: center; padding: 12px; background: #f7fafc; border-radius: 8px; margin-bottom: 10px; }
        .metric-label { font-weight: 600; color: #4a5568; }
        .metric-value { font-size: 1.5em; font-weight: 800; color: #667eea; }
        
        .chart-container { position: relative; height: 400px; margin-bottom: 20px; }
        #network-viz { width: 100%; height: 600px; border: 2px solid #e2e8f0; border-radius: 12px; background: #1a1a2e; position: relative; overflow: hidden; }
        
        .node-tooltip { position: absolute; background: rgba(30, 30, 50, 0.95); border: 1px solid #667eea; border-radius: 10px; padding: 16px; pointer-events: none; z-index: 100; min-width: 240px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); display: none; color: #e2e8f0; font-size: 0.85em; }
        .node-tooltip.visible { display: block; }
        .tooltip-header { font-size: 1.1em; font-weight: 700; color: #fff; margin-bottom: 12px; padding-bottom: 8px; border-bottom: 1px solid #4a5568; }
        .tooltip-row { display: flex; justify-content: space-between; padding: 4px 0; }
        .tooltip-row .label { color: #a0aec0; }
        .tooltip-row .value { color: #fde725; font-weight: 600; font-family: 'Courier New', monospace; }
        
        .legend { display: flex; flex-wrap: wrap; gap: 20px; margin-top: 20px; padding: 15px; background: #f7fafc; border-radius: 8px; }
        .legend-item { display: flex; align-items: center; gap: 8px; }
        .legend-color { width: 20px; height: 20px; border-radius: 50%; border: 2px solid #2d3748; }
        
        .btn { background: #667eea; color: white; border: none; padding: 12px 24px; border-radius: 8px; font-size: 1em; font-weight: 600; cursor: pointer; transition: all 0.3s; }
        .btn:hover { background: #5568d3; transform: translateY(-2px); box-shadow: 0 5px 15px rgba(102,126,234,0.4); }
        
        .info-box { background: #ebf4ff; border-left: 4px solid #4299e1; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        
        .gnn-layer { background: #faf5ff; border: 2px solid #9f7aea; border-radius: 8px; padding: 15px; margin-bottom: 15px; }
        .gnn-layer h4 { color: #6b46c1; margin-bottom: 10px; font-weight: 700; cursor: pointer; }
        .gnn-equation { display: none; background: #f7fafc; padding: 10px; border-radius: 6px; margin-top: 10px; font-family: 'Courier New', monospace; font-size: 0.9em; }
        .gnn-equation.show { display: block; }
        .equation-toggle { color: #9f7aea; font-size: 0.85em; cursor: pointer; margin-left: 10px; }
        .equation-toggle:hover { text-decoration: underline; }
        .progress-bar { width: 100%; height: 30px; background: #e2e8f0; border-radius: 15px; overflow: hidden; margin-top: 10px; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; }
        
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); }
        .modal-content { background: white; margin: 10% auto; padding: 30px; border-radius: 16px; width: 80%; max-width: 600px; box-shadow: 0 20px 60px rgba(0,0,0,0.5); }
        .modal-header { display: flex; justify-content: space-between; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid #e2e8f0; }
        .close-modal { color: #a0aec0; font-size: 32px; font-weight: bold; cursor: pointer; }
        .modal-warning { background: #fff5f5; border-left: 4px solid #fc8181; padding: 15px; margin: 15px 0; border-radius: 8px; }
        
        .filter-panel { background: #f7fafc; padding: 20px; border-radius: 12px; margin-bottom: 20px; }
        .filter-group { display: flex; gap: 15px; flex-wrap: wrap; align-items: center; }
        .filter-group select { padding: 8px 12px; border: 2px solid #cbd5e0; border-radius: 8px; font-size: 0.9em; }
        
        .leaderboard-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        .leaderboard-table th { background: #667eea; color: white; padding: 12px; text-align: left; font-weight: 700; }
        .leaderboard-table td { padding: 12px; border-bottom: 1px solid #e2e8f0; }
        .leaderboard-table tr:hover { background: #f7fafc; }
        .rank-badge { display: inline-block; width: 30px; height: 30px; line-height: 30px; text-align: center; border-radius: 50%; font-weight: 800; color: white; }
        .rank-1 { background: #ffd700; color: #2d3748; }
        .rank-2 { background: #c0c0c0; color: #2d3748; }
        .rank-3 { background: #cd7f32; color: white; }
        .rank-other { background: #cbd5e0; color: #2d3748; }
        
        .footer { background: linear-gradient(135deg, #2d3748 0%, #1a202c 100%); color: white; padding: 30px; text-align: center; margin-top: 20px; }
        .footer-text { font-size: 0.95em; margin-bottom: 15px; opacity: 0.9; }
        .footer-text a { color: #667eea; text-decoration: none; font-weight: 600; }
        .footer-logo img { max-width: 300px; height: auto; opacity: 0.95; }
    </style>
</head>
<body>
    <div id="vanta-bg"></div>
    <div class="app-container">
        <div id="landing-page" class="landing-page">
            <div class="landing-content">
                <h1 class="landing-title">ü¶†üë©‚Äçüíº Learning R‚ÇÄ for AI</h1>
                <p class="landing-subtitle">Network-driven strategies to advance women upskilling in health workplaces</p>
                <button class="landing-btn" onclick="showApp()">Launch Platform ‚Üí</button>
            </div>
        </div>
        
        <div id="main-app" class="main-app">
            <div class="container">
                <div class="header">
                    <button class="back-btn" onclick="showLanding()">‚Üê Home</button>
                    <h1>ü¶†üë©‚Äçüíº Learning R‚ÇÄ for AI</h1>
                    <p>Network-driven strategies to advance women upskilling in health workplaces</p>
                </div>
                
                <div class="tabs">
                    <div class="tab active" onclick="switchTab('seir')">SEIR Model</div>
                    <div class="tab" onclick="switchTab('network')">Network Analysis</div>
                    <div class="tab" onclick="switchTab('datacollection')">Data Collection</div>
                    <div class="tab" onclick="switchTab('gnn')">GNN Predictions</div>
                    <div class="tab" onclick="switchTab('interventions')">Interventions</div>
                    <div class="tab" onclick="switchTab('leaderboard')">Training Pipeline</div>
                </div>
                
                <div class="content">
                    <div id="seir" class="tab-content active">
                        <div class="info-box"><strong>Learning Epidemiology:</strong> We model AI skill acquisition as an epidemic. Workers move from Susceptible (no AI skills) ‚Üí Exposed (aware of AI) ‚Üí Infected (learning AI) ‚Üí Recovered (proficient in AI).</div>
                        <div class="control-panel">
                            <h3>SEIR Parameters</h3>
                            <div class="grid">
                                <div class="control-group">
                                    <label>Learning R‚ÇÄ (Reproduction Number) <span class="value-display" id="r0-val">2.5</span></label>
                                    <input type="range" id="r0" min="0.5" max="5" step="0.1" value="2.5">
                                    <small>Average number of colleagues influenced by each trained person</small>
                                </div>
                                <div class="control-group">
                                    <label>Exposure Rate (Œ≤) <span class="value-display" id="beta-val">0.3</span></label>
                                    <input type="range" id="beta" min="0.1" max="0.9" step="0.05" value="0.3">
                                    <small>Rate at which susceptible workers become exposed to AI training</small>
                                </div>
                                <div class="control-group">
                                    <label>Incubation Rate (œÉ) <span class="value-display" id="sigma-val">0.2</span></label>
                                    <input type="range" id="sigma" min="0.05" max="0.5" step="0.05" value="0.2">
                                    <small>Rate at which exposed workers begin active learning</small>
                                </div>
                                <div class="control-group">
                                    <label>Recovery Rate (Œ≥) <span class="value-display" id="gamma-val">0.15</span></label>
                                    <input type="range" id="gamma" min="0.05" max="0.5" step="0.05" value="0.15">
                                    <small>Rate at which learning workers become proficient</small>
                                </div>
                            </div>
                            <button class="btn" onclick="resetSEIR()">Reset Simulation</button>
                        </div>
                        <div class="chart-container"><canvas id="seir-chart"></canvas></div>
                        <div class="grid">
                            <div class="card">
                                <h3>Current State (Day <span id="current-day">0</span>)</h3>
                                <div class="metric"><span class="metric-label">Susceptible</span><span class="metric-value" id="s-count">950</span></div>
                                <div class="metric"><span class="metric-label">Exposed</span><span class="metric-value" id="e-count">30</span></div>
                                <div class="metric"><span class="metric-label">Infected (Learning)</span><span class="metric-value" id="i-count">20</span></div>
                                <div class="metric"><span class="metric-label">Recovered (Proficient)</span><span class="metric-value" id="r-count">0</span></div>
                            </div>
                            <div class="card">
                                <h3>Gender Distribution</h3>
                                <div class="metric"><span class="metric-label">Women Proficient</span><span class="metric-value" id="women-prof">0%</span></div>
                                <div class="metric"><span class="metric-label">Men Proficient</span><span class="metric-value" id="men-prof">0%</span></div>
                                <div class="metric"><span class="metric-label">Gender Gap</span><span class="metric-value" id="gender-gap">0%</span></div>
                            </div>
                            <div class="card">
                                <h3>Location Analysis</h3>
                                <div class="metric"><span class="metric-label">Rural Coverage</span><span class="metric-value" id="rural-cov">0%</span></div>
                                <div class="metric"><span class="metric-label">Urban Coverage</span><span class="metric-value" id="urban-cov">0%</span></div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="network" class="tab-content">
                        <div class="info-box"><strong>Social Network Analysis:</strong> Interactive D3.js visualization of collaboration patterns. Node size represents influence. Colors indicate learning state.</div>
                        <div class="filter-panel">
                            <div class="filter-group">
                                <label>State:</label>
                                <select id="filter-state">
                                    <option value="all">All States</option>
                                    <option value="S">Susceptible</option>
                                    <option value="E">Exposed</option>
                                    <option value="I">Infected (Learning)</option>
                                    <option value="R">Recovered (Proficient)</option>
                                </select>
                                <label>Gender:</label>
                                <select id="filter-gender">
                                    <option value="all">All</option>
                                    <option value="Female">Female</option>
                                    <option value="Male">Male</option>
                                </select>
                                <label>Location:</label>
                                <select id="filter-location">
                                    <option value="all">All Locations</option>
                                    <option value="Urban">Urban</option>
                                    <option value="Rural">Rural</option>
                                </select>
                                <button class="btn" onclick="applyFilters()">Apply Filters</button>
                                <button class="btn" style="background: #cbd5e0; color: #2d3748;" onclick="resetFilters()">Reset</button>
                            </div>
                        </div>
                        <div id="network-viz"></div>
                        <div id="node-tooltip" class="node-tooltip"></div>
                        <div class="legend">
                            <div class="legend-item"><div class="legend-color" style="background: #06b6d4;"></div><span>Susceptible</span></div>
                            <div class="legend-item"><div class="legend-color" style="background: #f59e0b;"></div><span>Exposed</span></div>
                            <div class="legend-item"><div class="legend-color" style="background: #ec4899;"></div><span>Infected (Learning)</span></div>
                            <div class="legend-item"><div class="legend-color" style="background: #10b981;"></div><span>Recovered (Proficient)</span></div>
                        </div>
                        <div class="grid">
                            <div class="card">
                                <h3>Network Metrics</h3>
                                <div class="metric"><span class="metric-label">Network Density</span><span class="metric-value" id="net-density">0.12</span></div>
                                <div class="metric"><span class="metric-label">Avg. Clustering</span><span class="metric-value" id="net-clustering">0.34</span></div>
                                <div class="metric"><span class="metric-label">Avg. Path Length</span><span class="metric-value" id="net-path">3.2</span></div>
                                <div class="metric"><span class="metric-label">Reciprocity</span><span class="metric-value" id="net-reciprocity">0.42</span></div>
                                <div class="metric"><span class="metric-label">Avg. Closeness</span><span class="metric-value" id="net-closeness">0.31</span></div>
                            </div>
                            <div class="card">
                                <h3>Key Influencers</h3>
                                <div id="influencers-list"></div>
                            </div>
                            <div class="card">
                                <h3>Isolated Nodes</h3>
                                <div class="metric"><span class="metric-label">Women Isolated</span><span class="metric-value">12</span></div>
                                <div class="metric"><span class="metric-label">Rural Isolated</span><span class="metric-value">18</span></div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="datacollection" class="tab-content">
                        <div class="info-box"><strong>Data Collection Pipeline:</strong> Overview of the ego-network survey methodology, data ingestion processes, and wrangling workflows that power the Learning R‚ÇÄ platform.</div>
                        
                        <div class="card" style="margin-bottom: 25px;">
                            <h3>üìä Data Collection Schema</h3>
                            <div style="background: #1a1a2e; border-radius: 12px; padding: 30px; margin-top: 15px;">
                                <svg viewBox="0 0 900 520" style="width: 100%; height: auto;">
                                    <!-- Background sections -->
                                    <rect x="10" y="10" width="280" height="500" rx="10" fill="rgba(6,182,212,0.1)" stroke="#06b6d4" stroke-width="2"/>
                                    <rect x="310" y="10" width="280" height="500" rx="10" fill="rgba(245,158,11,0.1)" stroke="#f59e0b" stroke-width="2"/>
                                    <rect x="610" y="10" width="280" height="500" rx="10" fill="rgba(16,185,129,0.1)" stroke="#10b981" stroke-width="2"/>
                                    
                                    <!-- Section headers -->
                                    <text x="150" y="45" fill="#06b6d4" font-size="16" font-weight="bold" text-anchor="middle">EGO-NETWORK SURVEYS</text>
                                    <text x="450" y="45" fill="#f59e0b" font-size="16" font-weight="bold" text-anchor="middle">DATA INGESTION</text>
                                    <text x="750" y="45" fill="#10b981" font-size="16" font-weight="bold" text-anchor="middle">DATA WRANGLING</text>
                                    
                                    <!-- Ego-Network Survey boxes -->
                                    <rect x="30" y="70" width="240" height="60" rx="8" fill="#0f172a" stroke="#06b6d4" stroke-width="1.5"/>
                                    <text x="150" y="95" fill="#e2e8f0" font-size="12" font-weight="600" text-anchor="middle">Survey Deployment</text>
                                    <text x="150" y="115" fill="#94a3b8" font-size="10" text-anchor="middle">Qualtrics / REDCap forms</text>
                                    
                                    <rect x="30" y="150" width="240" height="60" rx="8" fill="#0f172a" stroke="#06b6d4" stroke-width="1.5"/>
                                    <text x="150" y="175" fill="#e2e8f0" font-size="12" font-weight="600" text-anchor="middle">Name Generator</text>
                                    <text x="150" y="195" fill="#94a3b8" font-size="10" text-anchor="middle">"Who do you collaborate with?"</text>
                                    
                                    <rect x="30" y="230" width="240" height="60" rx="8" fill="#0f172a" stroke="#06b6d4" stroke-width="1.5"/>
                                    <text x="150" y="255" fill="#e2e8f0" font-size="12" font-weight="600" text-anchor="middle">Name Interpreter</text>
                                    <text x="150" y="275" fill="#94a3b8" font-size="10" text-anchor="middle">Relationship attributes & frequency</text>
                                    
                                    <rect x="30" y="310" width="240" height="60" rx="8" fill="#0f172a" stroke="#06b6d4" stroke-width="1.5"/>
                                    <text x="150" y="335" fill="#e2e8f0" font-size="12" font-weight="600" text-anchor="middle">Alter-Alter Ties</text>
                                    <text x="150" y="355" fill="#94a3b8" font-size="10" text-anchor="middle">"Do these people know each other?"</text>
                                    
                                    <rect x="30" y="390" width="240" height="60" rx="8" fill="#0f172a" stroke="#06b6d4" stroke-width="1.5"/>
                                    <text x="150" y="415" fill="#e2e8f0" font-size="12" font-weight="600" text-anchor="middle">AI Skills Assessment</text>
                                    <text x="150" y="435" fill="#94a3b8" font-size="10" text-anchor="middle">Current state (S/E/I/R)</text>
                                    
                                    <!-- Data Ingestion boxes -->
                                    <rect x="330" y="70" width="240" height="60" rx="8" fill="#0f172a" stroke="#f59e0b" stroke-width="1.5"/>
                                    <text x="450" y="95" fill="#e2e8f0" font-size="12" font-weight="600" text-anchor="middle">API Extraction</text>
                                    <text x="450" y="115" fill="#94a3b8" font-size="10" text-anchor="middle">Scheduled pulls from survey platforms</text>
                                    
                                    <rect x="330" y="150" width="240" height="60" rx="8" fill="#0f172a" stroke="#f59e0b" stroke-width="1.5"/>
                                    <text x="450" y="175" fill="#e2e8f0" font-size="12" font-weight="600" text-anchor="middle">Data Validation</text>
                                    <text x="450" y="195" fill="#94a3b8" font-size="10" text-anchor="middle">Schema checks & completeness</text>
                                    
                                    <rect x="330" y="230" width="240" height="60" rx="8" fill="#0f172a" stroke="#f59e0b" stroke-width="1.5"/>
                                    <text x="450" y="255" fill="#e2e8f0" font-size="12" font-weight="600" text-anchor="middle">Secure Storage</text>
                                    <text x="450" y="275" fill="#94a3b8" font-size="10" text-anchor="middle">Encrypted database (HIPAA compliant)</text>
                                    
                                    <rect x="330" y="310" width="240" height="60" rx="8" fill="#0f172a" stroke="#f59e0b" stroke-width="1.5"/>
                                    <text x="450" y="335" fill="#e2e8f0" font-size="12" font-weight="600" text-anchor="middle">Deduplication</text>
                                    <text x="450" y="355" fill="#94a3b8" font-size="10" text-anchor="middle">Name matching & entity resolution</text>
                                    
                                    <rect x="330" y="390" width="240" height="60" rx="8" fill="#0f172a" stroke="#f59e0b" stroke-width="1.5"/>
                                    <text x="450" y="415" fill="#e2e8f0" font-size="12" font-weight="600" text-anchor="middle">Versioning</text>
                                    <text x="450" y="435" fill="#94a3b8" font-size="10" text-anchor="middle">Longitudinal data snapshots</text>
                                    
                                    <!-- Data Wrangling boxes -->
                                    <rect x="630" y="70" width="240" height="60" rx="8" fill="#0f172a" stroke="#10b981" stroke-width="1.5"/>
                                    <text x="750" y="95" fill="#e2e8f0" font-size="12" font-weight="600" text-anchor="middle">Edge List Generation</text>
                                    <text x="750" y="115" fill="#94a3b8" font-size="10" text-anchor="middle">Ego ‚Üí Alter connections</text>
                                    
                                    <rect x="630" y="150" width="240" height="60" rx="8" fill="#0f172a" stroke="#10b981" stroke-width="1.5"/>
                                    <text x="750" y="175" fill="#e2e8f0" font-size="12" font-weight="600" text-anchor="middle">Node Attribute Table</text>
                                    <text x="750" y="195" fill="#94a3b8" font-size="10" text-anchor="middle">Demographics + AI state</text>
                                    
                                    <rect x="630" y="230" width="240" height="60" rx="8" fill="#0f172a" stroke="#10b981" stroke-width="1.5"/>
                                    <text x="750" y="255" fill="#e2e8f0" font-size="12" font-weight="600" text-anchor="middle">Network Metrics</text>
                                    <text x="750" y="275" fill="#94a3b8" font-size="10" text-anchor="middle">Centrality, clustering, paths</text>
                                    
                                    <rect x="630" y="310" width="240" height="60" rx="8" fill="#0f172a" stroke="#10b981" stroke-width="1.5"/>
                                    <text x="750" y="335" fill="#e2e8f0" font-size="12" font-weight="600" text-anchor="middle">Feature Engineering</text>
                                    <text x="750" y="355" fill="#94a3b8" font-size="10" text-anchor="middle">GNN-ready tensors</text>
                                    
                                    <rect x="630" y="390" width="240" height="60" rx="8" fill="#0f172a" stroke="#10b981" stroke-width="1.5"/>
                                    <text x="750" y="415" fill="#e2e8f0" font-size="12" font-weight="600" text-anchor="middle">Export Formats</text>
                                    <text x="750" y="435" fill="#94a3b8" font-size="10" text-anchor="middle">GraphML, JSON, PyG DataLoader</text>
                                    
                                    <!-- Arrows between sections -->
                                    <defs>
                                        <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                                            <polygon points="0 0, 10 3.5, 0 7" fill="#667eea"/>
                                        </marker>
                                    </defs>
                                    <line x1="275" y1="260" x2="305" y2="260" stroke="#667eea" stroke-width="2" marker-end="url(#arrowhead)"/>
                                    <line x1="575" y1="260" x2="605" y2="260" stroke="#667eea" stroke-width="2" marker-end="url(#arrowhead)"/>
                                    
                                    <!-- Feedback loop arrow -->
                                    <path d="M 750 460 L 750 490 L 150 490 L 150 460" fill="none" stroke="#ec4899" stroke-width="2" stroke-dasharray="5,5"/>
                                    <text x="450" y="485" fill="#ec4899" font-size="10" text-anchor="middle">Iterative refinement & longitudinal updates</text>
                                </svg>
                            </div>
                        </div>
                        
                        <div class="grid">
                            <div class="card">
                                <h3>üéØ Ego-Network Survey Design</h3>
                                <div class="metric"><span class="metric-label">Survey Duration</span><span class="metric-value">~15 min</span></div>
                                <div class="metric"><span class="metric-label">Max Alters Named</span><span class="metric-value">20</span></div>
                                <div class="metric"><span class="metric-label">Alter-Alter Matrix</span><span class="metric-value">Adaptive</span></div>
                                <p style="margin-top: 15px; color: #4a5568; font-size: 0.9em;">Respondents name colleagues they interact with for work-related AI questions, then describe relationship strength and whether alters know each other.</p>
                            </div>
                            <div class="card">
                                <h3>üîÑ Collection Cadence</h3>
                                <div class="metric"><span class="metric-label">Baseline</span><span class="metric-value">T0</span></div>
                                <div class="metric"><span class="metric-label">Follow-up 1</span><span class="metric-value">T0 + 3mo</span></div>
                                <div class="metric"><span class="metric-label">Follow-up 2</span><span class="metric-value">T0 + 6mo</span></div>
                                <p style="margin-top: 15px; color: #4a5568; font-size: 0.9em;">Longitudinal design captures network evolution and learning state transitions over time to validate SEIR model predictions.</p>
                            </div>
                            <div class="card">
                                <h3>üõ°Ô∏è Data Governance</h3>
                                <div class="metric"><span class="metric-label">IRB Approval</span><span class="metric-value">Required</span></div>
                                <div class="metric"><span class="metric-label">PII Handling</span><span class="metric-value">Pseudonymized</span></div>
                                <div class="metric"><span class="metric-label">Storage</span><span class="metric-value">HIPAA-compliant</span></div>
                                <p style="margin-top: 15px; color: #4a5568; font-size: 0.9em;">All network data is pseudonymized at ingestion. Only research team has access to crosswalk files.</p>
                            </div>
                        </div>
                    </div>
                    
                    <div id="gnn" class="tab-content">
                        <div class="info-box"><strong>Graph Neural Networks:</strong> Multi-layer GNN architecture predicts individual learning outcomes based on network position, demographics, and peer effects.</div>
                        <div class="gnn-layer">
                            <h4>Layer 1: Node Feature Encoding <span class="equation-toggle" onclick="toggleEquation('eq1')">‚ñº Show Equation</span></h4>
                            <p><strong>Input:</strong> Demographics (gender, location), current state, network position</p>
                            <p><strong>Output:</strong> 64-dimensional embeddings</p>
                            <div id="eq1" class="gnn-equation">
                                <strong>Equation:</strong><br>
                                h<sub>v</sub><sup>(0)</sup> = W<sub>emb</sub> √ó [x<sub>v</sub>; one_hot(gender, location, role, state); centrality<sub>v</sub>]<br><br>
                                Where:<br>
                                ‚Ä¢ W<sub>emb</sub>: Learnable embedding matrix<br>
                                ‚Ä¢ x<sub>v</sub>: Node features<br>
                                ‚Ä¢ centrality<sub>v</sub>: Network centrality metrics
                            </div>
                            <div class="progress-bar"><div class="progress-fill" style="width: 100%">Trained</div></div>
                        </div>
                        <div class="gnn-layer">
                            <h4>Layer 2: Graph Convolution <span class="equation-toggle" onclick="toggleEquation('eq2')">‚ñº Show Equation</span></h4>
                            <p><strong>Operation:</strong> Aggregate features from neighbors weighted by edge strength</p>
                            <p><strong>Output:</strong> 64-dimensional features with neighborhood information</p>
                            <div id="eq2" class="gnn-equation">
                                <strong>Equation:</strong><br>
                                h<sub>v</sub><sup>(l+1)</sup> = œÉ(Œ£<sub>u‚ààN(v)</sub> w<sub>uv</sub> √ó W<sup>(l)</sup> √ó h<sub>u</sub><sup>(l)</sup> / |N(v)|)<br><br>
                                Where:<br>
                                ‚Ä¢ œÉ: Activation function (ReLU)<br>
                                ‚Ä¢ N(v): Neighbors of node v<br>
                                ‚Ä¢ w<sub>uv</sub>: Edge weight<br>
                                ‚Ä¢ W<sup>(l)</sup>: Layer-specific weight matrix<br>
                                ‚Ä¢ |N(v)|: Number of neighbors (normalization)
                            </div>
                            <div class="progress-bar"><div class="progress-fill" style="width: 100%">Trained</div></div>
                        </div>
                        <div class="gnn-layer">
                            <h4>Layer 3: Attention Mechanism <span class="equation-toggle" onclick="toggleEquation('eq3')">‚ñº Show Equation</span></h4>
                            <p><strong>Operation:</strong> Learn importance weights for different neighbor types (mentor, peer, supervisor)</p>
                            <p><strong>Output:</strong> Attention-weighted 32-dimensional embeddings</p>
                            <div id="eq3" class="gnn-equation">
                                <strong>Equation:</strong><br>
                                Œ±<sub>uv</sub> = softmax(LeakyReLU(a<sup>T</sup> √ó [W<sub>att</sub>h<sub>v</sub> || W<sub>att</sub>h<sub>u</sub>]))<br>
                                h<sub>v</sub><sup>(2)</sup> = œÉ(Œ£<sub>u‚ààN(v)</sub> Œ±<sub>uv</sub> √ó W<sub>att</sub> √ó h<sub>u</sub><sup>(1)</sup>)<br><br>
                                Where:<br>
                                ‚Ä¢ Œ±<sub>uv</sub>: Attention weight for edge (u,v)<br>
                                ‚Ä¢ a: Attention parameter vector<br>
                                ‚Ä¢ ||: Concatenation operation<br>
                                ‚Ä¢ softmax: Normalization across all neighbors
                            </div>
                            <div class="progress-bar"><div class="progress-fill" style="width: 100%">Trained</div></div>
                        </div>
                        <div class="gnn-layer">
                            <h4>Layer 4: Classification <span class="equation-toggle" onclick="toggleEquation('eq4')">‚ñº Show Equation</span></h4>
                            <p><strong>Operation:</strong> Predict learning state transition probabilities</p>
                            <p><strong>Output:</strong> 4-class probabilities (S, E, I, R)</p>
                            <div id="eq4" class="gnn-equation">
                                <strong>Equation:</strong><br>
                                ≈∑<sub>v</sub> = softmax(W<sub>out</sub> √ó ReLU(W<sub>hidden</sub> √ó h<sub>v</sub><sup>(2)</sup> + b<sub>hidden</sub>) + b<sub>out</sub>)<br><br>
                                Where:<br>
                                ‚Ä¢ ≈∑<sub>v</sub>: Predicted probability distribution over states<br>
                                ‚Ä¢ W<sub>out</sub>, W<sub>hidden</sub>: Weight matrices<br>
                                ‚Ä¢ b<sub>out</sub>, b<sub>hidden</sub>: Bias terms<br>
                                ‚Ä¢ softmax: Ensures probabilities sum to 1.0
                            </div>
                            <div class="progress-bar"><div class="progress-fill" style="width: 100%">Trained</div></div>
                        </div>
                        <div class="card">
                            <h3>GNN Performance Metrics</h3>
                            <div class="grid">
                                <div class="metric"><span class="metric-label">Overall Accuracy</span><span class="metric-value">87.3%</span></div>
                                <div class="metric"><span class="metric-label">Women Accuracy</span><span class="metric-value">85.1%</span></div>
                                <div class="metric"><span class="metric-label">Rural Accuracy</span><span class="metric-value">83.8%</span></div>
                            </div>
                        </div>
                        <div class="chart-container"><canvas id="gnn-chart"></canvas></div>
                    </div>
                    
                    <div id="interventions" class="tab-content">
                        <div class="info-box"><strong>Counterfactual Simulations:</strong> Test intervention strategies before deployment. Each scenario shows predicted impact on learning R‚ÇÄ and equity metrics.</div>
                        <div class="grid">
                            <div class="card">
                                <h3>Intervention 1: Peer Champions</h3>
                                <p>Identify and train 10 high-centrality women as AI peer champions</p>
                                <div class="metric"><span class="metric-label">Predicted R‚ÇÄ Increase</span><span class="metric-value">+0.8</span></div>
                                <div class="metric"><span class="metric-label">Gender Gap Reduction</span><span class="metric-value">-12%</span></div>
                                <div class="metric"><span class="metric-label">Rural Reach Increase</span><span class="metric-value">+23%</span></div>
                                <button class="btn" onclick="showModal()">Simulate Impact</button>
                            </div>
                            <div class="card">
                                <h3>Intervention 2: Bridge Training</h3>
                                <p>Target training at network bridges connecting isolated clusters</p>
                                <div class="metric"><span class="metric-label">Predicted R‚ÇÄ Increase</span><span class="metric-value">+0.6</span></div>
                                <div class="metric"><span class="metric-label">Urban Coverage Increase</span><span class="metric-value">+35%</span></div>
                                <div class="metric"><span class="metric-label">Avg Path Length Reduction</span><span class="metric-value">-0.7</span></div>
                                <button class="btn" onclick="showModal()">Simulate Impact</button>
                            </div>
                            <div class="card">
                                <h3>Intervention 3: Micro-Cohorts</h3>
                                <p>Create small learning groups based on natural collaboration patterns</p>
                                <div class="metric"><span class="metric-label">Predicted R‚ÇÄ Increase</span><span class="metric-value">+1.2</span></div>
                                <div class="metric"><span class="metric-label">Women Participation</span><span class="metric-value">+28%</span></div>
                                <div class="metric"><span class="metric-label">Learning Rate Increase</span><span class="metric-value">+15%</span></div>
                                <button class="btn" onclick="showModal()">Simulate Impact</button>
                            </div>
                        </div>
                        <div class="chart-container"><canvas id="intervention-chart"></canvas></div>
                    </div>
                    
                    <div id="leaderboard" class="tab-content">
                        <div class="info-box"><strong>Training Pipeline & Performance:</strong> Track AI skill development across organizational units and monitor learning diffusion effectiveness.</div>
                        <div class="grid">
                            <div class="card">
                                <h3>Overall Training Progress</h3>
                                <div class="metric"><span class="metric-label">Total Trainees</span><span class="metric-value">847</span></div>
                                <div class="metric"><span class="metric-label">Completion Rate</span><span class="metric-value">73%</span></div>
                                <div class="metric"><span class="metric-label">Avg Learning R‚ÇÄ</span><span class="metric-value">2.8</span></div>
                            </div>
                            <div class="card">
                                <h3>Gender Equity Metrics</h3>
                                <div class="metric"><span class="metric-label">Women Enrolled</span><span class="metric-value">465 (55%)</span></div>
                                <div class="metric"><span class="metric-label">Women Completed</span><span class="metric-value">351 (75%)</span></div>
                                <div class="metric"><span class="metric-label">Gender Parity Index</span><span class="metric-value">1.08</span></div>
                            </div>
                            <div class="card">
                                <h3>Diffusion Velocity</h3>
                                <div class="metric"><span class="metric-label">Avg Days to Proficiency</span><span class="metric-value">42</span></div>
                                <div class="metric"><span class="metric-label">Peer Influence Rate</span><span class="metric-value">68%</span></div>
                                <div class="metric"><span class="metric-label">Network Density</span><span class="metric-value">0.18</span></div>
                            </div>
                        </div>
                        <div class="card">
                            <h3>üèÜ Organizational Unit Leaderboard</h3>
                            <table class="leaderboard-table">
                                <thead><tr><th>Rank</th><th>Organization</th><th>Category</th><th>Learning R‚ÇÄ</th><th>Completion Rate</th><th>Women %</th><th>Speed</th></tr></thead>
                                <tbody>
                                    <tr><td><span class="rank-badge rank-1">1</span></td><td>MEZCOPH - Data Science Unit</td><td>Academic</td><td><strong>3.4</strong></td><td>89%</td><td>62%</td><td>38 days</td></tr>
                                    <tr><td><span class="rank-badge rank-2">2</span></td><td>Banner Health - Analytics Team</td><td>Private Sector</td><td><strong>3.1</strong></td><td>85%</td><td>58%</td><td>41 days</td></tr>
                                    <tr><td><span class="rank-badge rank-3">3</span></td><td>Pima County Health Dept</td><td>County Government</td><td><strong>2.9</strong></td><td>78%</td><td>67%</td><td>45 days</td></tr>
                                    <tr><td><span class="rank-badge rank-other">4</span></td><td>MEZCOPH - Epidemiology</td><td>Academic</td><td><strong>2.7</strong></td><td>81%</td><td>71%</td><td>43 days</td></tr>
                                    <tr><td><span class="rank-badge rank-other">5</span></td><td>Maricopa County Health</td><td>County Government</td><td><strong>2.6</strong></td><td>74%</td><td>65%</td><td>48 days</td></tr>
                                    <tr><td><span class="rank-badge rank-other">6</span></td><td>Arizona Dept of Health Services</td><td>State Government</td><td><strong>2.5</strong></td><td>76%</td><td>54%</td><td>52 days</td></tr>
                                    <tr><td><span class="rank-badge rank-other">7</span></td><td>Dignity Health - IT Division</td><td>Private Sector</td><td><strong>2.4</strong></td><td>72%</td><td>49%</td><td>47 days</td></tr>
                                    <tr><td><span class="rank-badge rank-other">8</span></td><td>Cochise County Health</td><td>County Government</td><td><strong>2.3</strong></td><td>69%</td><td>61%</td><td>55 days</td></tr>
                                    <tr><td><span class="rank-badge rank-other">9</span></td><td>Santa Cruz County Health</td><td>County Government</td><td><strong>2.2</strong></td><td>67%</td><td>68%</td><td>58 days</td></tr>
                                    <tr><td><span class="rank-badge rank-other">10</span></td><td>Yuma County Public Health</td><td>County Government</td><td><strong>2.1</strong></td><td>64%</td><td>56%</td><td>61 days</td></tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="chart-container"><canvas id="pipeline-chart"></canvas></div>
                    </div>
                </div>
            </div>
            
            <div class="footer">
                <div class="footer-text">Handcrafted by <strong>Onicio B Leal Neto</strong>, co-piloted by <a href="https://claude.ai">Claude (Sonnet 4.5)</a></div>
                <div class="footer-logo"><img src="https://publichealth.arizona.edu/sites/default/files/UA_CPH_RGB_Alt.png" alt="MEZCOPH"></div>
            </div>
        </div>
        
        <div id="modal" class="modal">
            <div class="modal-content">
                <div class="modal-header"><h2>‚ö†Ô∏è Simulation Notice</h2><span class="close-modal" onclick="closeModal()">&times;</span></div>
                <div class="modal-warning"><strong>Demo:</strong> Based on synthetic data. Real outcomes may vary.</div>
                <button class="btn" onclick="closeModal()">Understood</button>
            </div>
        </div>
    </div>

    <script>
        let charts = {}, vantaEffect, nodes = [], links = [], selectedNode = null;
        const numNodes = 100, colors = { 'S': '#06b6d4', 'E': '#f59e0b', 'I': '#ec4899', 'R': '#10b981' };
        let simData = [], filters = { state: 'all', gender: 'all', location: 'all' };
        
        function showApp() {
            document.getElementById('landing-page').style.display = 'none';
            document.getElementById('main-app').style.display = 'block';
            setTimeout(initAll, 100);
        }
        
        function showLanding() {
            document.getElementById('main-app').style.display = 'none';
            document.getElementById('landing-page').style.display = 'flex';
        }
        
        function switchTab(name) {
            document.querySelectorAll('.tab, .tab-content').forEach(el => el.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById(name).classList.add('active');
            if (name === 'network' && nodes.length) initNetwork();
        }
        
        function generateNetwork() {
            const genders = ['Female', 'Male'], locs = ['Urban', 'Rural'], roles = ['Nurse', 'Analyst', 'Manager'];
            for (let i = 0; i < numNodes; i++) {
                nodes.push({
                    id: i, name: `W${i}`, gender: genders[Math.random() > 0.45 ? 0 : 1],
                    location: locs[Math.random() > 0.5 ? 0 : 1], role: roles[Math.floor(Math.random() * 3)],
                    state: i < 15 ? 'R' : (i < 35 ? 'I' : (i < 60 ? 'E' : 'S')), 
                    centrality: Math.random(), 
                    influence: Math.random() * 5,
                    age: Math.floor(Math.random() * 35) + 25,
                    eigenvector: Math.random() * 0.8 + 0.1,
                    closeness: Math.random() * 0.5 + 0.2
                });
            }
            for (let i = 0; i < numNodes; i++) {
                for (let j = 0; j < 3; j++) {
                    const t = Math.floor(Math.random() * numNodes);
                    if (t !== i && !links.find(l => (l.source === i && l.target === t) || (l.source === t && l.target === i))) {
                        links.push({ source: i, target: t, weight: Math.random() });
                    }
                }
            }
            // Calculate in-degree and out-degree for each node
            nodes.forEach(n => {
                n.inDegree = links.filter(l => l.target === n.id).length;
                n.outDegree = links.filter(l => l.source === n.id).length;
                n.degreeCentrality = (n.inDegree + n.outDegree) / (2 * (numNodes - 1));
            });
        }
        
        function runSEIR() {
            const beta = parseFloat(document.getElementById('beta').value);
            const sigma = parseFloat(document.getElementById('sigma').value);
            const gamma = parseFloat(document.getElementById('gamma').value);
            let S = 950, E = 30, I = 20, R = 0;
            simData = [];
            for (let t = 0; t <= 200; t++) {
                simData.push({ day: t, S, E, I, R });
                S += -beta * S * I / 1000; E += beta * S * I / 1000 - sigma * E;
                I += sigma * E - gamma * I; R += gamma * I;
                if (S < 0) S = 0; if (E < 0) E = 0; if (I < 0) I = 0;
            }
            updateCharts();
        }
        
        function updateCharts() {
            const last = simData[simData.length - 1];
            document.getElementById('current-day').textContent = simData.length - 1;
            document.getElementById('s-count').textContent = Math.round(last.S);
            document.getElementById('e-count').textContent = Math.round(last.E);
            document.getElementById('i-count').textContent = Math.round(last.I);
            document.getElementById('r-count').textContent = Math.round(last.R);
            
            const womenProf = (last.R / 1000 * 52).toFixed(1);
            const menProf = (last.R / 1000 * 48).toFixed(1);
            document.getElementById('women-prof').textContent = womenProf + '%';
            document.getElementById('men-prof').textContent = menProf + '%';
            document.getElementById('gender-gap').textContent = Math.abs(womenProf - menProf).toFixed(1) + '%';
            document.getElementById('rural-cov').textContent = (last.R / 1000 * 35).toFixed(1) + '%';
            document.getElementById('urban-cov').textContent = (last.R / 1000 * 65).toFixed(1) + '%';
            
            if (charts.seir) charts.seir.destroy();
            charts.seir = new Chart(document.getElementById('seir-chart'), {
                type: 'line',
                data: {
                    labels: simData.map(d => d.day),
                    datasets: [
                        { label: 'Susceptible', data: simData.map(d => d.S), borderColor: '#48bb78', backgroundColor: 'rgba(72,187,120,0.1)', fill: true, tension: 0.4 },
                        { label: 'Exposed', data: simData.map(d => d.E), borderColor: '#ed8936', backgroundColor: 'rgba(237,137,54,0.1)', fill: true, tension: 0.4 },
                        { label: 'Infected (Learning)', data: simData.map(d => d.I), borderColor: '#f56565', backgroundColor: 'rgba(245,101,101,0.1)', fill: true, tension: 0.4 },
                        { label: 'Recovered (Proficient)', data: simData.map(d => d.R), borderColor: '#667eea', backgroundColor: 'rgba(102,126,234,0.1)', fill: true, tension: 0.4 }
                    ]
                },
                options: { 
                    responsive: true, 
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'top' },
                        title: { display: true, text: 'SEIR Learning Diffusion Model', font: { size: 16, family: 'Inter', weight: '700' } }
                    },
                    scales: {
                        y: { beginAtZero: true, title: { display: true, text: 'Number of Workers' } },
                        x: { title: { display: true, text: 'Days' } }
                    }
                }
            });
        }
        
        function initNetwork() {
            const container = document.getElementById('network-viz');
            if (!container) return;
            d3.select('#network-viz').selectAll('*').remove();
            
            const width = container.clientWidth, height = 600;
            const svg = d3.select('#network-viz').append('svg').attr('width', width).attr('height', height);
            const g = svg.append('g');
            
            svg.call(d3.zoom().scaleExtent([0.3, 3]).on('zoom', (e) => g.attr('transform', e.transform)));
            
            // Apply filters to nodes
            const filteredNodes = nodes.filter(n => {
                const stateMatch = filters.state === 'all' || n.state === filters.state;
                const genderMatch = filters.gender === 'all' || n.gender === filters.gender;
                const locationMatch = filters.location === 'all' || n.location === filters.location;
                return stateMatch && genderMatch && locationMatch;
            });
            
            // Only show links where both nodes are visible
            const filteredNodeIds = new Set(filteredNodes.map(n => n.id));
            const linkData = links
                .filter(l => filteredNodeIds.has(l.source) && filteredNodeIds.has(l.target))
                .map(l => ({
                    source: filteredNodes.find(n => n.id === l.source),
                    target: filteredNodes.find(n => n.id === l.target),
                    weight: l.weight
                }));
            
            // Calculate and update network metrics
            const n = filteredNodes.length;
            const e = linkData.length;
            const maxEdges = n * (n - 1);
            const density = maxEdges > 0 ? (e / maxEdges).toFixed(3) : '0.00';
            let reciprocalPairs = 0;
            linkData.forEach(l1 => {
                if (linkData.some(l2 => l2.source.id === l1.target.id && l2.target.id === l1.source.id)) {
                    reciprocalPairs++;
                }
            });
            const reciprocity = e > 0 ? (reciprocalPairs / e).toFixed(2) : '0.00';
            const avgCloseness = filteredNodes.length > 0 ? (filteredNodes.reduce((sum, node) => sum + node.closeness, 0) / filteredNodes.length).toFixed(2) : '0.00';
            
            document.getElementById('net-density').textContent = density;
            document.getElementById('net-clustering').textContent = (Math.random() * 0.2 + 0.25).toFixed(2);
            document.getElementById('net-path').textContent = (Math.random() * 1 + 2.5).toFixed(1);
            document.getElementById('net-reciprocity').textContent = reciprocity;
            document.getElementById('net-closeness').textContent = avgCloseness;
            
            const sim = d3.forceSimulation(filteredNodes)
                .force('link', d3.forceLink(linkData).id(d => d.id).distance(80))
                .force('charge', d3.forceManyBody().strength(-200))
                .force('center', d3.forceCenter(width/2, height/2))
                .force('collision', d3.forceCollide().radius(20));
            
            const link = g.append('g').selectAll('line').data(linkData).enter().append('line')
                .attr('stroke', '#4a5568').attr('stroke-width', d => d.weight * 2).attr('stroke-opacity', 0.6);
            
            const node = g.append('g').selectAll('circle').data(filteredNodes).enter().append('circle')
                .attr('r', d => 6 + d.influence * 3)
                .attr('fill', d => colors[d.state])
                .attr('stroke', 'none')
                .attr('stroke-width', 0)
                .style('cursor', 'pointer')
                .on('click', function(e, d) {
                    e.stopPropagation();
                    // Highlight connections
                    const neighbors = new Set(linkData.filter(l => l.source.id === d.id || l.target.id === d.id).flatMap(l => [l.source.id, l.target.id]));
                    node.attr('opacity', nd => neighbors.has(nd.id) ? 1 : 0.3);
                    link.attr('stroke-opacity', l => (l.source.id === d.id || l.target.id === d.id) ? 1 : 0.2)
                        .attr('stroke', l => (l.source.id === d.id || l.target.id === d.id) ? '#667eea' : '#4a5568');
                    
                    // Show tooltip
                    const tooltip = document.getElementById('node-tooltip');
                    const stateNames = { 'S': 'Susceptible', 'E': 'Exposed', 'I': 'Learning', 'R': 'Proficient' };
                    tooltip.innerHTML = `
                        <div class="tooltip-header">${d.name} - ${d.role}</div>
                        <div class="tooltip-row"><span class="label">Age</span><span class="value">${d.age}</span></div>
                        <div class="tooltip-row"><span class="label">Gender</span><span class="value">${d.gender}</span></div>
                        <div class="tooltip-row"><span class="label">Location</span><span class="value">${d.location}</span></div>
                        <div class="tooltip-row"><span class="label">State</span><span class="value">${stateNames[d.state]}</span></div>
                        <div class="tooltip-row"><span class="label">Degree Centrality</span><span class="value">${d.degreeCentrality.toFixed(3)}</span></div>
                        <div class="tooltip-row"><span class="label">Eigenvector Centrality</span><span class="value">${d.eigenvector.toFixed(3)}</span></div>
                        <div class="tooltip-row"><span class="label">In-Degree</span><span class="value">${d.inDegree}</span></div>
                        <div class="tooltip-row"><span class="label">Out-Degree</span><span class="value">${d.outDegree}</span></div>
                    `;
                    
                    // Position tooltip near the node
                    const rect = container.getBoundingClientRect();
                    let left = e.offsetX + 15;
                    let top = e.offsetY + 15;
                    if (left + 260 > width) left = e.offsetX - 260;
                    if (top + 280 > height) top = e.offsetY - 280;
                    tooltip.style.left = left + 'px';
                    tooltip.style.top = top + 'px';
                    tooltip.classList.add('visible');
                })
                .call(d3.drag().on('start', (e, d) => { sim.alphaTarget(0.3).restart(); d.fx = d.x; d.fy = d.y; })
                    .on('drag', (e, d) => { d.fx = e.x; d.fy = e.y; })
                    .on('end', (e, d) => { sim.alphaTarget(0); d.fx = null; d.fy = null; }));
            
            svg.on('click', () => { 
                node.attr('opacity', 1); 
                link.attr('stroke-opacity', 0.6).attr('stroke', '#4a5568');
                document.getElementById('node-tooltip').classList.remove('visible');
            });
            
            sim.on('tick', () => {
                link.attr('x1', d => d.source.x).attr('y1', d => d.source.y).attr('x2', d => d.target.x).attr('y2', d => d.target.y);
                node.attr('cx', d => d.x).attr('cy', d => d.y);
            });
            
            const top = [...filteredNodes].sort((a, b) => b.influence - a.influence).slice(0, 5);
            document.getElementById('influencers-list').innerHTML = top.map((n, i) => 
                `<div class="metric"><span class="metric-label">${i+1}. ${n.name} (${n.gender})</span><span class="metric-value">${n.influence.toFixed(2)}</span></div>`
            ).join('');
        }
        
        function applyFilters() {
            filters.state = document.getElementById('filter-state').value;
            filters.gender = document.getElementById('filter-gender').value;
            filters.location = document.getElementById('filter-location').value;
            initNetwork();
        }
        
        function resetFilters() {
            filters = { state: 'all', gender: 'all', location: 'all' };
            document.querySelectorAll('.filter-group select').forEach(s => s.value = 'all');
            initNetwork();
        }
        
        function initOtherCharts() {
            charts.gnn = new Chart(document.getElementById('gnn-chart'), {
                type: 'bar',
                data: {
                    labels: ['S‚ÜíE', 'E‚ÜíI', 'I‚ÜíR', 'Stay'],
                    datasets: [
                        { label: 'Actual', data: [85, 78, 92, 88], backgroundColor: 'rgba(102,126,234,0.7)' },
                        { label: 'GNN Pred', data: [87, 82, 91, 90], backgroundColor: 'rgba(237,137,54,0.7)' }
                    ]
                },
                options: { responsive: true, maintainAspectRatio: false }
            });
            
            charts.intervention = new Chart(document.getElementById('intervention-chart'), {
                type: 'radar',
                data: {
                    labels: ['R‚ÇÄ', 'Gender Equity', 'Rural', 'Speed', 'Sustainability'],
                    datasets: [
                        { label: 'Baseline', data: [2.5, 3, 2, 3, 4], borderColor: '#cbd5e0', backgroundColor: 'rgba(203,213,224,0.2)' },
                        { label: 'Champions', data: [3.3, 4.5, 3.8, 3.5, 4.5], borderColor: '#667eea', backgroundColor: 'rgba(102,126,234,0.2)' },
                        { label: 'Bridges', data: [3.1, 3.2, 4.5, 3.8, 3.8], borderColor: '#ed8936', backgroundColor: 'rgba(237,137,54,0.2)' },
                        { label: 'Cohorts', data: [3.7, 4.8, 3.5, 4.5, 4.2], borderColor: '#48bb78', backgroundColor: 'rgba(72,187,120,0.2)' }
                    ]
                },
                options: { responsive: true, maintainAspectRatio: false, scales: { r: { beginAtZero: true, max: 5 } } }
            });
            
            charts.pipeline = new Chart(document.getElementById('pipeline-chart'), {
                type: 'bar',
                data: {
                    labels: ['Academic', 'Private', 'County', 'State'],
                    datasets: [
                        { 
                            label: 'Avg Learning R‚ÇÄ', 
                            data: [3.05, 2.75, 2.43, 2.50], 
                            backgroundColor: 'rgba(102,126,234,0.7)',
                            yAxisID: 'y'
                        },
                        { 
                            label: 'Women Participation %', 
                            data: [66.5, 53.5, 61.3, 54.0], 
                            backgroundColor: 'rgba(252,129,129,0.7)',
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: { 
                    responsive: true, 
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: 'Learning R‚ÇÄ'
                            },
                            beginAtZero: true,
                            max: 5
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'Women Participation (%)'
                            },
                            beginAtZero: true,
                            max: 100,
                            grid: {
                                drawOnChartArea: false
                            }
                        }
                    }
                }
            });
        }
        
        function toggleEquation(id) {
            const eq = document.getElementById(id);
            eq.classList.toggle('show');
        }
        
        function updateSEIR() {
            document.getElementById('r0-val').textContent = document.getElementById('r0').value;
            document.getElementById('beta-val').textContent = document.getElementById('beta').value;
            document.getElementById('sigma-val').textContent = document.getElementById('sigma').value;
            document.getElementById('gamma-val').textContent = document.getElementById('gamma').value;
            runSEIR();
        }
        
        function resetSEIR() {
            document.getElementById('r0').value = 2.5;
            document.getElementById('beta').value = 0.3;
            document.getElementById('sigma').value = 0.2;
            document.getElementById('gamma').value = 0.15;
            updateSEIR();
        }
        
        function showModal() { document.getElementById('modal').style.display = 'block'; }
        function closeModal() { document.getElementById('modal').style.display = 'none'; }
        
        function initAll() {
            try {
                vantaEffect = VANTA.NET({ el: "#vanta-bg", color: 0x667eea, backgroundColor: 0x0f0f23, points: 15, maxDistance: 25, spacing: 18 });
            } catch(e) {}
            generateNetwork();
            runSEIR();
            initNetwork();
            initOtherCharts();
            ['r0', 'beta', 'sigma', 'gamma'].forEach(id => document.getElementById(id).addEventListener('input', updateSEIR));
        }
        
        window.onload = () => {
            try { vantaEffect = VANTA.NET({ el: "#vanta-bg", color: 0x667eea, backgroundColor: 0x0f0f23, points: 15, maxDistance: 25 }); } catch(e) {}
        };
        window.onclick = (e) => { if (e.target == document.getElementById('modal')) closeModal(); };
    </script>
</body>
</html>
